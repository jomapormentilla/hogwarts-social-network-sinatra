
<div class="row py-2">
    <div class="col-md-12">
        <div class="alert alert-dark text-center"><h1><%= @wizard.username.upcase %></h1></div>
    </div>
    <% if flash.has?(:message) %>
        <div class="col-md-12">
            <div class="alert alert-<%= flash[:alert_type]%> text-center"><%= flash[:message] %></div>
        </div>
    <% end %>

    <div class="col-sm-6 col-md-3">
        <div class="card">
            <div class="card-header text-center"><h2><%= @wizard.name %></h2></div>
            <img src="<%= @wizard.img_url == nil ? '/images/hogwarts-logo-300x300.png' : @wizard.img_url %>" alt="profile" class="card-img-top p-2" />
            <div class="card-body">
                <p>House: <a href="/houses/<%= @wizard.house.slug %>"><%= @wizard.house.name %></a></p>
                <p>Wand: <%= @wizard.wand != nil ? @wizard.wand.name : 'Does not own a wand' %></p>
                
                <% if is_current_session? @wizard %>
                    <hr />
                    <a href="/wizards/<%= @wizard.slug %>/edit" class="btn btn-block btn-outline-secondary btn-sm">Edit</a>
                    <br />
                    <form action="/logout" method="POST">
                        <button type="submit" class="btn btn-block btn-outline-danger btn-sm float-right">Logout</button>
                    </form>
                <% end %>
            </div>
        </div><br />
    </div>

    <div class="col-sm-6">
        <% if is_current_session? @wizard %>
            <div class="card shadow">
                <div class="card-header"><h3>Create a New Post</h3></div>
                <div class="card-body">
                    <form action="/posts" method="POST">
                        <input type="text" name="post[title]" placeholder="Post Title..." class="form-control" /><br />
                        <textarea name="post[content]" placeholder="Post Content..." class="form-control"></textarea><br />
                        <button class="btn btn-block btn-outline-secondary">Create Post</button>
                    </form>
                </div>
            </div><br />
        <% end %>
            
        </form>

        <% if @wizard.posts.empty? %>
            <div class="alert alert-info text-center"><%= @wizard.username.upcase %> does not have any posts.</div>
        <% else %>
            <% @wizard.posts.order(:id).reverse[0..19].each do |post| %>
                <div class="card">
                    <div class="card-header">
                        <% if is_current_session? @wizard %>
                            <a href="/posts/<%= post.id %>/edit" class="btn btn-outline-warning btn-sm float-right">Edit</a>
                        <% end %>
                        <h2><%= post.title %></h2>
                    </div>
                    <div class="card-body">
                        <span style="color: #777;"><%= parse_timestamp post.timestamp %></span></p>
                        <p class="card-text"><%= post.content %></p>
                        
                        <form action="/posts/<%= post.id %>/upvote" method="POST">
                            <button type="submit" class="btn btn-outline-info btn-sm" <%= 'disabled' if post.upvotes.any?{|up| up.wizard == current_wizard} %>><%= post.upvotes.size %> Upvote<%= 's' if post.upvotes.size != 1 %></button> &nbsp; 
                            <a href="/posts/<%= post.id %>" type="button" class="btn btn-outline-primary btn-sm"><%= post.comments.size %> Comment<%= 's' if post.comments.size != 1 %></a>
                        </form>
                    </div>
                </div><br />
            <% end %>
        <% end %>
    </div>

    <div class="col-md-3">
        <div class="card">
            <h4 class="card-header">Friends (<%= @all_friends.size %>)</h4>
            <div class="card-body">
                <% if !current_wizard.friends.include?(@wizard) && !is_current_session?(@wizard) %>
                    <form action="/wizards/<%= @wizard.slug %>/add_friend" method="POST">
                        <input type="hidden" name="friend_id" value="<%= @wizard.slug %>" />
                        <button type="submit" class="btn btn-block btn-outline-primary btn-sm">Add as Friend</button>
                    </form><br />
                <% end %>

                <% if current_wizard.friends.include?(@wizard) && !is_current_session?(@wizard) %>
                    <form action="/wizards/<%= @wizard.slug %>/remove_friend" method="POST">
                        <input type="hidden" name="friend_id" value="<%= @wizard.slug %>" />
                        <button type="submit" class="btn btn-block btn-outline-danger btn-sm">Unfriend</button>
                    </form><br />
                <% end %>

                <% @all_friends.sort_by(&:name).each do |friend| %>
                    <p><a href="/wizards/<%= friend.slug %>"><%= friend.name %></a></p>
                <% end %>
            </div>
        </div>
    </div>
</div>
<br />
